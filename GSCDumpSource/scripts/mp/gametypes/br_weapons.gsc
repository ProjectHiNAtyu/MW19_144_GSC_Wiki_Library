// IW8 GSC SOURCE
// Generated by https://github.com/xensik/gsc-tool

createspawnweaponatpos( var_0, var_1, var_2 )
{
    var_3 = scripts\engine\trace::ray_trace( var_0, ( var_0[0], var_0[1], var_0[2] - 60 ) );
    var_4 = var_0;

    if ( var_3["fraction"] < 1.0 )
        var_4 = var_3["position"] + ( 0, 0, 2 );

    if ( !isdefined( var_1 ) )
        var_1 = ( 0, 0, 90 );

    var_0 = var_4;

    if ( isdefined( var_1 ) )
        var_1 = var_1;
    else
        var_1 = ( 0, 0, 90 );

    var_5 = scripts\mp\gametypes\br_pickups.gsc::nospectatablepropswatch( var_0, var_1 );
    return weaponspawn( var_2, undefined, var_5, 1 );
}

createspawnweaponatposfromname( var_0, var_1 )
{
    var_2 = var_0;
    var_3 = scripts\engine\trace::ray_trace( var_0, ( var_0[0], var_0[1], var_0[2] - 60 ) );

    if ( var_3["fraction"] < 1.0 )
        var_2 = var_3["position"] + ( 0, 0, 2 );

    var_4 = scripts\mp\gametypes\br_pickups.gsc::nospectatablepropswatch( var_0, ( 0, 0, 90 ) );
    return weaponspawn( var_1, undefined, var_4, 1 );
}

stripweaponsfromplayer()
{
    var_0 = undefined;
    var_1 = undefined;

    foreach ( var_3 in self.equippedweapons )
    {
        var_4 = scripts\mp\utility\weapon::getweaponrootname( var_3.basename );

        if ( var_4 != "iw8_fists" && var_4 != "iw8_knifestab" && var_4 != "iw8_gunless" )
        {
            if ( issameweapon( var_3 ) && var_3.inventorytype == "primary" )
            {
                var_5 = scripts\mp\utility\weapon::getweaponrootname( self.currentprimaryweapon );

                if ( var_4 == var_5 )
                    var_0 = var_3;
                else
                    var_1 = var_3;
            }
        }
    }

    if ( isdefined( var_0 ) )
        var_7 = scripts\mp\utility\weapon::getweaponrootname( var_0.basename );

    if ( isdefined( var_1 ) )
        var_8 = scripts\mp\utility\weapon::getweaponrootname( var_1.basename );

    if ( isdefined( var_0 ) || isdefined( var_1 ) )
    {
        if ( isdefined( var_0 ) )
            scripts\cp_mp\utility\inventory_utility::_takeweapon( var_0, 1 );

        if ( isdefined( var_1 ) )
            scripts\cp_mp\utility\inventory_utility::_takeweapon( var_1, 1 );

        scripts\cp_mp\utility\inventory_utility::_giveweapon( "iw8_fists_mp" );
        scripts\cp_mp\utility\inventory_utility::_switchtoweaponimmediate( "iw8_fists_mp" );
    }
}

playerdropweaponfrominventory( var_0 )
{
    var_1 = undefined;
    var_2 = undefined;

    foreach ( var_4 in self.equippedweapons )
    {
        var_5 = scripts\mp\utility\weapon::getweaponrootname( var_4.basename );

        if ( var_5 != "iw8_fists" && var_5 != "iw8_knifestab" )
        {
            if ( issameweapon( var_4 ) && var_4.inventorytype == "primary" )
            {
                var_6 = scripts\mp\utility\weapon::getweaponrootname( self.currentprimaryweapon );

                if ( var_5 == var_6 )
                {
                    iprintln( "PRIMARY IS " + var_5 );
                    var_1 = var_4;
                }
                else
                    var_2 = var_4;
            }
        }
    }

    var_8 = undefined;
    var_9 = undefined;
    var_10 = "";
    var_11 = "";

    if ( isdefined( var_1 ) )
        var_10 = scripts\mp\utility\weapon::getweaponrootname( var_1.basename );

    if ( isdefined( var_2 ) )
        var_11 = scripts\mp\utility\weapon::getweaponrootname( var_2.basename );

    if ( var_0 == var_10 )
    {
        var_8 = var_1;
        var_9 = var_2;
    }
    else if ( var_0 == var_11 )
    {
        var_8 = var_2;
        var_9 = var_1;
    }

    var_12 = 0;

    if ( isdefined( var_8 ) )
    {
        var_13 = self getweaponammoclip( var_8 );
        var_14 = scripts\mp\gametypes\br_pickups.gsc::register_respawn_functions();
        var_15 = scripts\mp\gametypes\br_pickups.gsc::getitemdroporiginandangles( var_14, self.origin, self.angles, self );
        var_16 = weaponspawn( var_8, self, var_15, 0 );
        var_16.count = var_13;
        scripts\cp_mp\utility\inventory_utility::_takeweapon( var_8 );

        if ( isdefined( var_9 ) )
            scripts\cp_mp\utility\inventory_utility::_switchtoweaponimmediate( var_9 );
        else
        {
            scripts\cp_mp\utility\inventory_utility::_giveweapon( "iw8_fists_mp" );
            scripts\cp_mp\utility\inventory_utility::_switchtoweaponimmediate( "iw8_fists_mp" );
        }

        br_ammo_update_weapons( self );
    }
}

weaponspawn( var_0, var_1, var_2, var_3, var_4 )
{
    var_5 = createheadicon( var_0 );
    var_6 = scripts\mp\gametypes\br_pickups.gsc::spawnpickup( var_5, var_2, 0, var_4, var_0 );
    level.update_health_on_spawn scripts\mp\trials\trial_target_utility::determinetrackingcirclesize( var_6, var_1, var_0 );
    return var_6;
}

takeweaponpickup( var_0 )
{
    var_1 = self.primaryweapons.size;

    if ( !isdefined( var_0.weapon ) )
    {
        var_2 = [];
        var_3 = undefined;

        if ( isdefined( var_0.customweaponname ) )
        {
            var_4 = var_0.customweaponname;
            var_3 = asmdevgetallstates( var_4 );
            var_3.customweaponname = var_0.customweaponname;
        }
        else if ( !isdefined( var_0.completeweapon ) )
        {
            var_3 = scripts\mp\gametypes\br_pickups.gsc::new_objective( var_0 );
            var_4 = createheadicon( var_3 );
        }
        else
        {
            var_3 = scripts\mp\class::buildweapon( var_0.loadoutprimaryfullname, var_2, "none", "none", -1 );
            var_4 = var_0.loadoutprimaryfullname;
        }

        if ( !isdefined( var_4 ) )
        {
            scripts\mp\utility\script::handle_train_veh_collision( "takeWeaponPickup error - scriptable not setup for pickup: " + var_0.scriptablename );
            return;
        }

        var_5 = scripts\mp\utility\weapon::getweaponrootname( var_4 );
        var_6 = var_4;
    }
    else
    {
        var_3 = var_0.weapon;

        if ( isdefined( var_0.loadoutprimaryfullname ) )
            var_6 = var_0.loadoutprimaryfullname;
        else
            var_6 = getsubstr( var_3.classname, 7, var_3.classname.size );

        var_5 = scripts\mp\utility\weapon::getweaponrootname( var_6 );
    }

    var_7 = 0;
    var_8 = undefined;
    var_9 = 0;

    foreach ( var_11 in self.primaryweapons )
    {
        if ( nullweapon( var_11 ) )
        {
            var_1--;
            continue;
        }

        if ( isnullweapon( var_11, var_3 ) )
        {
            var_9 = 1;
            var_7 = 1;
            var_8 = var_11;
        }
    }

    if ( var_1 > 1 )
    {
        if ( !self hasweapon( "iw8_fists_mp" ) )
            var_7 = 1;
        else if ( !var_9 )
            self takeweapon( "iw8_fists_mp" );
    }

    if ( var_7 )
    {
        if ( !isdefined( var_8 ) )
            var_8 = self.lastdroppableweaponobj;

        if ( var_8.basename != "none" )
        {
            var_13 = self getweaponammoclip( var_8 );
            var_14 = self getweaponammoclip( var_8, "left" );
            var_15 = 0;

            if ( var_8.hasalternate )
            {
                var_16 = var_8 getaltweapon();

                if ( !choppersupport_isplayeractive( var_8, var_16 ) )
                    var_15 = self getweaponammoclip( var_16 );
            }

            if ( !scripts\mp\riotshield::isriotshield( var_8 ) )
            {
                var_17 = self getweaponammostock( var_8 );
                var_18 = br_ammo_type_for_weapon( var_8 );

                if ( isdefined( var_18 ) )
                    self.br_ammo[var_18] = var_17;
            }

            var_19 = var_0.origin - self.origin;
            var_20 = vectortoyaw( var_19 );
            var_21 = !scripts\mp\gametypes\br_extract_quest.gsc::jugg_dmg_debug( var_8 );

            if ( var_21 )
            {
                var_22 = scripts\mp\gametypes\br_pickups.gsc::nospectatablepropswatch( var_0.origin, ( 0, var_20, 0 ) );
                var_23 = tablesort( var_22.origin, 500, 500 );
                var_23[var_23.size] = self;
                var_24 = scripts\engine\trace::create_contents( 0, 1, 1, 1, 0, 1, 1, 0, 1 );
                var_25 = var_22.origin;
                var_26 = -1 * getdvarfloat( "bg_maxLootDropHeight", 2000.0 );
                var_27 = var_22.origin + ( 0.0, 0.0, var_26 );
                var_28 = scripts\engine\trace::ray_trace( var_25, var_27, var_23, var_24 );

                if ( var_28["fraction"] < 1.0 )
                    var_22.phone = var_28["entity"];

                var_29 = weaponspawn( var_8, self, var_22, 0 );

                if ( isdefined( var_29 ) )
                {
                    scripts\mp\gametypes\br_pickups.gsc::spawn_lmg_soldiers_04( var_29, var_13, var_14, var_15 );
                    var_30 = 1;
                    scripts\mp\gametypes\br_analytics.gsc::branalytics_lootdrop( self, var_8.basename, var_30, var_13 );
                }
            }

            scripts\cp_mp\utility\inventory_utility::_takeweapon( var_8 );
        }
    }

    self giveweapon( var_6 );
    self notify( "pickedupweapon", var_6 );

    if ( istrue( var_3.isweaponfromcrate ) || istrue( var_0.isweaponfromcrate ) )
    {
        var_31 = br_ammo_type_for_weapon( var_5 );

        if ( isdefined( var_31 ) )
        {
            var_32 = weaponclipsize( var_3 );
            br_ammo_give_type( self, var_31, var_32 );
        }
    }
    else
    {
        var_33 = var_0.count;
        var_34 = var_0.gas_flyby_plane;
        var_32 = weaponclipsize( var_3 );
        var_35 = 0;

        if ( var_33 > var_32 )
        {
            var_35 = var_35 + ( var_33 - var_32 );
            var_33 = var_32;
        }

        if ( var_34 > var_32 )
        {
            var_35 = var_35 + ( var_34 - var_32 );
            var_34 = var_32;
        }

        self setweaponammoclip( var_6, var_33 );
        self setweaponammoclip( var_6, var_34, "left" );

        if ( var_35 > 0 )
        {
            var_31 = br_ammo_type_for_weapon( var_3 );

            if ( isdefined( var_31 ) )
                br_ammo_give_type( self, var_31, var_35 );
        }

        if ( var_3.hasalternate )
        {
            var_36 = var_0.gas_attack;
            var_37 = var_3 getaltweapon();

            if ( !choppersupport_isplayeractive( var_3, var_37 ) )
            {
                var_38 = weaponclipsize( var_37 );

                if ( var_36 > var_38 )
                    var_36 = var_38;

                self setweaponammoclip( var_37, var_36 );
            }
        }
    }

    var_3._id_11F6D = undefined;
    br_ammo_update_weapons( self );
    self assignweaponprimaryslot( var_6 );
    scripts\cp_mp\utility\inventory_utility::_switchtoweaponimmediate( var_6 );
    scripts\mp\weapons::fixupplayerweapons( self, var_6 );
    scripts\mp\weapons::updatelastweaponobj( var_3 );

    if ( isdefined( var_0.weapon ) && isent( var_0.weapon ) )
        var_0.weapon delete();

    var_39 = undefined;

    foreach ( var_41 in self.equippedweapons )
    {
        if ( issameweapon( var_41 ) && var_41.inventorytype == "primary" )
        {
            var_4 = createheadicon( var_41 );

            if ( var_4 == var_6 )
            {
                var_39 = var_41;
                break;
            }
        }
    }

    thread scripts\mp\gametypes\br_respawn.gsc::giveweaponpickup( var_6 );

    if ( isdefined( var_0.relic_squadlink_toofar_hud_logic ) )
        level.update_health_think scripts\mp\trials\trial_target_utility::determinetrackingcirclesize( var_0.relic_squadlink_toofar_hud_logic, self, var_3 );
}

takeammopickup( var_0 )
{
    var_1 = 0;

    if ( var_0.scriptablename == "Ammo_Crate" )
    {
        var_2 = self getcurrentweapon().basename;
        var_3 = scripts\mp\utility\weapon::getweaponrootname( var_2 );
        var_4 = weaponclipsize( var_2 );
        var_5 = br_ammo_type_for_weapon( var_2 );

        if ( isdefined( var_5 ) )
            var_1 = br_ammo_give_type( self, var_5, var_4 );
    }
    else
        var_1 = br_ammo_give_type( self, var_0.scriptablename, var_0.count, 1 );

    if ( var_1 )
    {
        var_0.count = var_1;
        var_6 = 1;
    }
    else
        var_6 = 0;

    return var_6;
}

br_forcegiveweapon( var_0, var_1, var_2 )
{
    if ( !scripts\engine\utility::array_contains( level.br_pickups.br_lootguns, var_0 ) )
        var_0 = claymoreshitby();

    var_3 = spawnstruct();
    var_3.loadoutprimaryfullname = var_0;
    var_3.scriptablename = scripts\mp\utility\weapon::getweaponrootname( var_0 );
    var_3.completeweapon = var_2;
    var_3.count = 0;
    var_3.gas_flyby_plane = 0;
    var_3.gas_attack = 0;
    var_1 takeweaponpickup( var_3 );
}

claymoreshitby( var_0, var_1 )
{
    if ( !isdefined( var_0 ) )
        var_0 = "ar";

    if ( !isdefined( var_1 ) )
        var_1 = "comm";

    var_2 = [];

    foreach ( var_4 in level.br_pickups.br_lootguns )
    {
        if ( issubstr( var_4, "_" + var_0 + "_" ) )
        {
            if ( issubstr( var_4, "_" + var_1 ) )
                var_2[var_2.size] = var_4;
        }
    }

    return var_2[randomint( var_2.size )];
}

br_getweaponstartingclipammo( var_0 )
{
    var_1 = weaponclipsize( var_0 );
    return int( var_1 );
}

br_forcegivecustomweapon( var_0, var_1, var_2, var_3, var_4, var_5 )
{
    if ( var_0 hasweapon( var_1 ) )
    {
        var_0 scripts\mp\hud_message::showerrormessage( "MP/BR_ALREADY_HOLDING_WEAPON" );
        return 0;
    }

    var_6 = var_1 hasattachment( "maxammo" );
    var_7 = spawnstruct();
    var_7.weapon = var_1;
    var_7.loadoutprimaryfullname = var_2;
    var_7.scriptablename = var_3;
    var_7.origin = var_0.origin + ( 0, 0, 24 );
    var_7.count = br_getweaponstartingclipammo( var_1 );
    var_7.gas_flyby_plane = 0;
    var_7.gas_attack = 0;

    if ( var_6 )
        var_7.count = 999;

    if ( isdefined( var_4 ) && isdefined( var_5 ) )
    {
        var_8 = weaponclipsize( var_1 );
        var_9 = int( ceil( var_8 * var_4 ) );
        var_7.count = int( min( var_9, var_5 ) );
    }

    if ( scripts\mp\utility\weapon::respawnplayers( var_1 ) )
        var_7.gas_flyby_plane = var_7.count;

    if ( var_1.hasalternate )
    {
        var_10 = var_1 getaltweapon();

        if ( !choppersupport_isplayeractive( var_1, var_10 ) )
        {
            var_11 = weaponclipsize( var_10 );
            var_7.gas_attack = var_11;

            if ( var_6 )
                var_7.gas_attack = 999;
        }
    }

    if ( getdvarint( "scr_br_request_streaming_weapons", 0 ) > 0 )
        var_0 loadweaponsforplayer( [ var_7.loadoutprimaryfullname ] );

    var_0 takeweaponpickup( var_7 );

    if ( var_1.hasalternate )
    {
        var_12 = var_1 getaltweapon();

        if ( var_12.isalternate && scripts\mp\utility\weapon::attachmentmap_tobase( var_12.underbarrel ) == "ubshtgn" )
        {
            var_13 = weaponclipsize( var_12 );
            var_14 = int( var_13 );
            var_0 setweaponammoclip( var_12, var_14 );
        }
    }

    return 1;
}

br_ammo_init()
{
    level.br_ammo_types = [];
    level.br_ammo_types[0] = "brloot_ammo_919";
    level.br_ammo_types[1] = "brloot_ammo_12g";
    level.br_ammo_types[2] = "brloot_ammo_762";
    level.br_ammo_types[3] = "brloot_ammo_50cal";
    level.br_ammo_types[4] = "brloot_ammo_rocket";
    level.br_ammo_clipsize["brloot_ammo_919"] = 30;
    level.br_ammo_clipsize["brloot_ammo_12g"] = 8;
    level.br_ammo_clipsize["brloot_ammo_762"] = 30;
    level.br_ammo_clipsize["brloot_ammo_50cal"] = 8;
    level.br_ammo_clipsize["brloot_ammo_rocket"] = 1;
    level.br_ammo_max = [];
    level.br_ammo_omnvars = [];
    level.br_ammo_omnvars["brloot_ammo_919"] = "ui_br_smallarms_ammo";
    level.br_ammo_omnvars["brloot_ammo_12g"] = "ui_br_shotgun_ammo";
    level.br_ammo_omnvars["brloot_ammo_762"] = "ui_br_assault_ammo";
    level.br_ammo_omnvars["brloot_ammo_50cal"] = "ui_br_sniper_ammo";
    level.br_ammo_omnvars["brloot_ammo_rocket"] = "ui_br_rocket_ammo";
}

br_ammo_player_init()
{
    self endon( "disconnect" );
    thread br_ammo_player_reload_watch();
    thread br_ammo_player_hud_monitor();

    for (;;)
    {
        self waittill( "br_spawned" );

        if ( !scripts\mp\flags::gameflag( "prematch_done" ) )
        {
            var_0 = self getweaponslistprimaries();

            foreach ( var_2 in var_0 )
            {
                var_3 = weaponclipsize( var_2 );

                if ( isdefined( var_3 ) )
                {
                    if ( scripts\mp\utility\weapon::respawnplayers( var_2 ) )
                    {
                        self setweaponammoclip( var_2, var_3, "left" );
                        self setweaponammoclip( var_2, var_3, "right" );
                        continue;
                    }

                    self setweaponammoclip( var_2, var_3 );
                }
            }
        }

        foreach ( var_6 in level.br_ammo_types )
        {
            if ( !scripts\mp\flags::gameflag( "prematch_done" ) )
            {
                self.br_ammo[var_6] = level.br_ammo_max[var_6];
                continue;
            }

            self.br_ammo[var_6] = 0;
        }

        br_ammo_update_weapons( self );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_919" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_12g" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_762" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_50cal" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_rocket" );
    }
}

clean_enemy_ai()
{
    if ( scripts\mp\gametypes\br_gametypes.gsc::roof_enemy_groups( "weapons" ) )
        return;

    br_ammo_give_type( self, "brloot_ammo_919", 30, 0 );
}

br_ammo_player_clear()
{
    if ( scripts\mp\gametypes\br_gametypes.gsc::roof_enemy_groups( "weapons" ) )
        return;

    foreach ( var_1 in level.br_ammo_types )
        self.br_ammo[var_1] = 0;

    self notify( "ammo_update" );
}

choppersupport_issmallpatrolmap()
{
    var_0 = self;
    var_1 = var_0 getweaponslistprimaries();

    foreach ( var_3 in var_1 )
    {
        var_4 = br_ammo_type_for_weapon( var_3 );

        if ( isdefined( var_4 ) )
        {
            var_5 = var_0 getweaponammoclip( var_3, "right" );
            var_6 = weaponclipsize( var_3 );

            if ( var_5 < var_6 )
                return 0;

            if ( var_3 hasattachment( "akimbo", 1 ) )
            {
                var_7 = var_0 getweaponammoclip( var_3, "left" );

                if ( var_7 < var_6 )
                    return 0;
            }

            if ( !br_ammo_type_player_full( var_0, var_4 ) )
                return 0;
        }
    }

    return 1;
}

choppersupport_modifydamage_trial()
{
    var_0 = self;
    var_1 = [];
    var_2 = var_0 getweaponslistprimaries();

    foreach ( var_4 in var_2 )
    {
        var_5 = br_ammo_type_for_weapon( var_4 );

        if ( isdefined( var_5 ) )
        {
            var_1[var_5] = "dummy_value";
            var_6 = weaponclipsize( var_4 );
            var_0 setweaponammoclip( var_4, var_6 );
        }
    }

    foreach ( var_5, var_9 in var_1 )
    {
        var_0.br_ammo[var_5] = level.br_ammo_max[var_5];
        var_0 br_ammo_player_hud_update_ammotype( var_5 );
    }

    br_ammo_update_weapons( var_0 );
}

br_ammo_type_player_full( var_0, var_1 )
{
    if ( !isdefined( var_0.br_ammo ) || !isdefined( var_0.br_ammo[var_1] ) )
        return 0;

    if ( !isdefined( level.br_ammo_max[var_1] ) )
        return 0;

    return scripts\mp\gametypes\br.gsc::get_int_or_0( var_0.br_ammo[var_1] ) >= level.br_ammo_max[var_1];
}

br_ammo_give_type( var_0, var_1, var_2, var_3 )
{
    choppersupport_watchforlaststand( var_0, var_1 );

    if ( br_ammo_type_player_full( var_0, var_1 ) )
        return var_2;

    if ( !isdefined( var_0.br_ammo ) )
        var_0.br_ammo = [];

    if ( !isdefined( var_0.br_ammo[var_1] ) )
        var_0.br_ammo[var_1] = 0;

    if ( !isdefined( var_3 ) )
        var_3 = 0;

    var_4 = 0;
    var_0.br_ammo[var_1] = var_0.br_ammo[var_1] + var_2;

    if ( var_0.br_ammo[var_1] > level.br_ammo_max[var_1] )
    {
        if ( var_3 )
        {
            var_4 = var_0.br_ammo[var_1] - level.br_ammo_max[var_1];

            if ( var_4 < level.br_ammo_clipsize[var_1] )
                var_4 = 0;
        }

        var_0.br_ammo[var_1] = level.br_ammo_max[var_1];
    }

    var_0 br_ammo_player_hud_update_ammotype( var_1 );
    choppersupport_watchleash( var_0, var_1 );
    return var_4;
}

choppersupport_watchforlaststand( var_0, var_1 )
{
    if ( !var_0 isreloading() )
        return;

    var_2 = var_0 getcurrentprimaryweapon();
    var_3 = br_ammo_type_for_weapon( var_2 );

    if ( isdefined( var_3 ) && var_1 == var_3 )
        var_0.br_ammo[var_1] = var_0 getweaponammostock( var_2 );
}

br_ammo_take_type( var_0, var_1, var_2 )
{
    if ( var_0.br_ammo[var_1] <= 0 )
        return 0;

    var_0.br_ammo[var_1] = var_0.br_ammo[var_1] - var_2;

    if ( var_0.br_ammo[var_1] < 0 )
        var_0.br_ammo[var_1] = 0;

    var_0 br_ammo_player_hud_update_ammotype( var_1 );
    br_ammo_update_weapons( var_0 );
    return 1;
}

br_ammo_player_hud_monitor()
{
    level endon( "game_ended" );
    self endon( "disconnect" );

    for (;;)
    {
        scripts\engine\utility::_id_133F2( "ammo_update", "pickedupweapon", "weapon_switch_done", "weapon_change", "weapon_change_complete" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_919" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_12g" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_762" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_50cal" );
        br_ammo_player_hud_update_ammotype( "brloot_ammo_rocket" );
    }
}

br_ammo_player_hud_update_ammotype( var_0, var_1 )
{
    if ( isdefined( level.br_ammo_omnvars[var_0] ) )
    {
        if ( !isdefined( self.br_ammo ) )
            self.br_ammo = [];

        if ( !isdefined( self.br_ammo[var_0] ) )
            self.br_ammo[var_0] = 0;

        self setclientomnvar( level.br_ammo_omnvars[var_0], self.br_ammo[var_0] );
    }
}

br_ammo_update_weapons( var_0 )
{
    if ( scripts\mp\gametypes\br_gametypes.gsc::roof_enemy_groups( "weapons" ) )
        return;

    if ( !isdefined( var_0 ) )
        return;

    var_1 = var_0 getweaponslistprimaries();

    foreach ( var_3 in var_1 )
    {
        var_4 = br_ammo_type_for_weapon( var_3 );

        if ( isdefined( var_4 ) )
        {
            var_5 = scripts\mp\gametypes\br.gsc::get_int_or_0( var_0.br_ammo[var_4] );
            var_0 setweaponammostock( var_3, var_5 );
        }
    }

    var_0 notify( "ammo_update" );
}

choppersupport_watchleash( var_0, var_1 )
{
    if ( !isdefined( var_0 ) || !isdefined( var_1 ) )
        return;

    var_2 = self getweaponslistprimaries();

    foreach ( var_4 in var_2 )
    {
        var_5 = br_ammo_type_for_weapon( var_4 );

        if ( isdefined( var_5 ) && var_1 == var_5 )
        {
            var_6 = scripts\mp\gametypes\br.gsc::get_int_or_0( var_0.br_ammo[var_1] );
            var_0 setweaponammostock( var_4, var_6 );
        }
    }

    var_0 notify( "ammo_update" );
}

br_ammo_type_for_weapon( var_0 )
{
    var_1 = undefined;
    var_2 = [ "selectsemi", "selectsemi_falpha", "selectsemi_anov94" ];
    var_3 = [ "ubshtgn", "ubshtgn02", "ubshtgn_mike4" ];

    if ( var_0.isalternate && isdefined( var_0.underbarrel ) && !scripts\engine\utility::array_contains( var_2, var_0.underbarrel ) )
    {
        if ( scripts\engine\utility::array_contains( var_3, var_0.underbarrel ) )
            return undefined;
        else
            var_1 = "weapon_projectile";
    }
    else
        var_1 = scripts\mp\utility\weapon::getweapongroup( var_0 );

    switch ( var_1 )
    {
        case "weapon_machine_pistol":
        case "weapon_pistol":
            if ( var_0.basename == "iw8_pi_t9pistolshot_mp" )
                return "brloot_ammo_12g";
        case "weapon_smg":
            return "brloot_ammo_919";
        case "weapon_shotgun":
            return "brloot_ammo_12g";
        case "weapon_lmg":
        case "weapon_assault":
        case "weapon_tactical":
            return "brloot_ammo_762";
        case "weapon_dmr":
        case "weapon_sniper":
            return "brloot_ammo_50cal";
        case "weapon_projectile":
            return "brloot_ammo_rocket";
    }

    return undefined;
}

choppersupport_isplayeractive( var_0, var_1 )
{
    var_2 = br_ammo_type_for_weapon( var_0 );
    var_3 = br_ammo_type_for_weapon( var_1 );
    return isdefined( var_2 ) && isdefined( var_3 ) && var_2 == var_3;
}

br_ammo_player_reload_watch()
{
    level endon( "game_ended" );
    self endon( "disconnect" );

    for (;;)
    {
        self waittill( "reload_start" );

        if ( !isdefined( self ) )
            return;

        if ( scripts\mp\gametypes\br_public.gsc::isplayeringulag() )
            continue;

        var_0 = self getcurrentweapon();
        var_1 = br_ammo_type_for_weapon( var_0 );

        if ( !isdefined( var_1 ) )
            continue;

        clearhint( var_0 );

        if ( !isdefined( self ) )
            return;

        if ( var_0 != self getcurrentweapon() )
            continue;

        if ( !getdvarint( "scr_prematch_infinite_ammo", istrue( level._id_11B61 ) ) || scripts\mp\flags::gameflag( "prematch_done" ) )
            self.br_ammo[var_1] = self getweaponammostock( var_0 );

        choppersupport_watchleash( self, var_1 );
    }
}

clearhint( var_0 )
{
    level endon( "game_ended" );
    self endon( "death_or_disconnect" );
    self endon( "weapon_fired" );

    while ( self isreloading() )
        waitframe();
}

clean_up_eliminate_drone( var_0, var_1 )
{
    var_2 = self;

    if ( !isdefined( var_1 ) )
        var_1 = 1;

    var_3 = br_ammo_type_for_weapon( var_0 );

    if ( isdefined( var_3 ) )
    {
        var_4 = int( level.br_ammo_clipsize[var_3] * var_1 );
        var_2.br_ammo[var_3] = int( clamp( var_2.br_ammo[var_3] + var_4, 0, level.br_ammo_max[var_3] ) );
    }

    choppersupport_watchleash( var_2, var_3 );
}

clean_up_combat_action( var_0, var_1 )
{
    var_2 = self;
    var_3 = br_ammo_type_for_weapon( var_0 );

    if ( isdefined( var_3 ) )
        var_2.br_ammo[var_3] = int( clamp( var_2.br_ammo[var_3] + var_1, 0, level.br_ammo_max[var_3] ) );

    choppersupport_watchleash( var_2, var_3 );
}

score_event_turret_killed( var_0 )
{
    if ( !isdefined( var_0 ) )
        return 0;

    if ( !issameweapon( var_0 ) )
        return 0;

    if ( nullweapon( var_0 ) )
        return 0;

    if ( scripts\mp\weapons::isfistweapon( var_0 ) || scripts\mp\utility\weapon::round_at_max( var_0 ) || scripts\mp\utility\weapon::run_and_stop_group_after( var_0 ) )
        return 0;

    return 1;
}

clip_mover()
{
    if ( istrue( level.choppergunner_watchexplosioninfluencepoint ) && !scripts\mp\gametypes\br_public.gsc::risk_flagspawnshiftingcenter() )
        return 1;
}

create_puddle_triggers( var_0 )
{
    foreach ( var_2 in var_0 )
        snapshot_grenade_applysnapshot( var_2, istrue( var_2.player_infil_already_played ) );
}

snapshot_grenade_applysnapshot( var_0, var_1 )
{
    var_2 = br_ammo_type_for_weapon( var_0 );
    var_3 = weaponstartammo( var_0 );
    var_4 = weaponclipsize( var_0 );
    var_5 = weaponmaxammo( var_0 );
    var_6 = undefined;

    if ( var_1 )
        var_6 = var_5;
    else
        var_6 = var_3 - var_4;

    if ( isdefined( var_2 ) )
        br_ammo_give_type( self, var_2, var_6 );
}
